<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>State Statistics Regression · ClimateMachine</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="ClimateMachine logo"/></a><div class="docs-package-name"><span class="docs-autofit">ClimateMachine</span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><a class="tocitem" href="../../../../Installation/">Installation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Experiments</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-3-1" type="checkbox"/><label class="tocitem" for="menuitem-3-1"><span class="docs-label">AtmosGCM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../experiments/AtmosGCM/heldsuarez/">heldsuarez.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">AtmosLES</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../experiments/AtmosLES/bomex/">bomex.jl</a></li><li><a class="tocitem" href="../../../experiments/AtmosLES/dycoms/">dycoms.jl</a></li><li><a class="tocitem" href="../../../experiments/AtmosLES/risingbubble/">risingbubble.jl</a></li><li><a class="tocitem" href="../../../experiments/AtmosLES/surfacebubble/">surfacebubble.jl</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-3" type="checkbox"/><label class="tocitem" for="menuitem-3-3"><span class="docs-label">OceanBoxGCM</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../experiments/OceanBoxGCM/homogeneous_box/">homogeneous_box.jl</a></li><li><a class="tocitem" href="../../../experiments/OceanBoxGCM/ocean_gyre/">ocean_gyre.jl</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-1"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Atmos/heldsuarez/">Dry Idealized GCM</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><input class="collapse-toggle" id="menuitem-4-3" type="checkbox"/><label class="tocitem" for="menuitem-4-3"><span class="docs-label">Land</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-3-1" type="checkbox"/><label class="tocitem" for="menuitem-4-3-1"><span class="docs-label">Heat</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Land/Heat/heat_equation/">Heat Equation</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-4" type="checkbox"/><label class="tocitem" for="menuitem-4-4"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-4-1" type="checkbox"/><label class="tocitem" for="menuitem-4-4-1"><span class="docs-label">LinearSolvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../Numerics/LinearSolvers/cg/">Conjugate Gradient</a></li><li><a class="tocitem" href="../../../Numerics/LinearSolvers/bgmres/">Batched Generalized Minimal Residual</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-5" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-4-5-1" type="checkbox" checked/><label class="tocitem" for="menuitem-4-5-1"><span class="docs-label">Debug</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>State Statistics Regression</a><ul class="internal"><li><a class="tocitem" href="#.-Generating-statistics-for-a-set-of-MPIStateArrays-1"><span>1. Generating statistics for a set of MPIStateArrays</span></a></li><li><a class="tocitem" href="#.-Comparing-to-reference-values-1"><span>2. Comparing to reference values</span></a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-4-6" type="checkbox"/><label class="tocitem" for="menuitem-4-6"><span class="docs-label">Contributing</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../literate_markdown/">Notes on Literate</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">How-to-guides</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Contributing/CONTRIBUTING/">Home</a></li><li><span class="tocitem">Arrays</span></li><li><input class="collapse-toggle" id="menuitem-5-3" type="checkbox"/><label class="tocitem" for="menuitem-5-3"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Common/SurfaceFluxes/">SurfaceFluxes</a></li><li><a class="tocitem" href="../../../../HowToGuides/Common/MoistThermodynamics/">MoistThermodynamics</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-4" type="checkbox"/><label class="tocitem" for="menuitem-5-4"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../HowToGuides/Atmos/Model/risingbubble/">Rising Bubble LES</a></li><li><a class="tocitem" href="../../../../HowToGuides/Atmos/Microphysics/">Microphysics</a></li><li><a class="tocitem" href="../../../../HowToGuides/Atmos/Model/turbulence/">Turbulence</a></li><li><a class="tocitem" href="../../../../HowToGuides/Atmos/Model/tracers/">Tracers</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-5-7" type="checkbox"/><label class="tocitem" for="menuitem-5-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Diagnostics/DiagnosticVariables/">Variables</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-8" type="checkbox"/><label class="tocitem" for="menuitem-5-8"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><span class="tocitem">Meshes</span></li><li><input class="collapse-toggle" id="menuitem-5-8-2" type="checkbox"/><label class="tocitem" for="menuitem-5-8-2"><span class="docs-label">DG methods</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Numerics/DGmethods/how_to_make_a_balance_law/">How to make a balance law</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-8-3" type="checkbox"/><label class="tocitem" for="menuitem-5-8-3"><span class="docs-label">ODE Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Numerics/ODESolvers/Timestepping/">Time-integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5-8-4" type="checkbox"/><label class="tocitem" for="menuitem-5-8-4"><span class="docs-label">Linear Solvers</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../HowToGuides/Numerics/LinearSolvers/IterativeSolvers/">Iterative Solvers</a></li></ul></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">APIs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/">Home</a></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Atmos/AtmosModel/">AtmosModel</a></li><li><a class="tocitem" href="../../../../APIs/Atmos/Microphysics/">Microphysics</a></li></ul></li><li><span class="tocitem">Ocean</span></li><li><span class="tocitem">Land</span></li><li><input class="collapse-toggle" id="menuitem-6-5" type="checkbox"/><label class="tocitem" for="menuitem-6-5"><span class="docs-label">Common</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Common/SurfaceFluxes/">Surface Fluxes</a></li></ul></li><li><a class="tocitem" href="../../../../APIs/Arrays/Arrays/">Arrays</a></li><li><input class="collapse-toggle" id="menuitem-6-7" type="checkbox"/><label class="tocitem" for="menuitem-6-7"><span class="docs-label">Diagnostics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Diagnostics/Diagnostics/">List of variables</a></li><li><a class="tocitem" href="../../../../APIs/Diagnostics/InputOutput/">Input/Output</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-8" type="checkbox"/><label class="tocitem" for="menuitem-6-8"><span class="docs-label">Numerics</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../APIs/Numerics/Meshes/Mesh/">Meshes</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/LinearSolvers/LinearSolvers/">LinearSolvers</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/ODESolvers/ODESolvers/">ODESolvers</a></li><li><a class="tocitem" href="../../../../APIs/Numerics/DGmethods/BalanceLawOverview/">Balance Law</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Theory &amp; design philosophy</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Discussions/">Home</a></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Atmos</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../Discussions/Atmos/EDMFEquations/">Eddy-Diffusivity Mass-Flux (EDMF) equations</a></li></ul></li></ul></li><li><input class="collapse-toggle" id="menuitem-8" type="checkbox"/><label class="tocitem" for="menuitem-8"><span class="docs-label">Developer docs</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../CodingConventions/">Coding Conventions</a></li><li><a class="tocitem" href="../../../../AcceptableUnicode/">Acceptable Unicode characters</a></li><li><a class="tocitem" href="../../../../VariableList/">ClimateMachine Variable List</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li><a class="is-disabled">Diagnostics</a></li><li><a class="is-disabled">Debug</a></li><li class="is-active"><a href>State Statistics Regression</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>State Statistics Regression</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/CliMA/ClimateMachine.jl/blob/master/tutorials/Diagnostics/Debug/StateCheck.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="State-debug-statistics-1"><a class="docs-heading-anchor" href="#State-debug-statistics-1">State debug statistics</a><a class="docs-heading-anchor-permalink" href="#State-debug-statistics-1" title="Permalink"></a></h1><p>This page shows how to use the <code>StateCheck</code> functions to get basic statistics for nodal values of fields held in ClimateMachine <code>MPIStateArray</code> data structures. The <code>StateCheck</code> functions can be used to</p><ol><li><p>Generate statistics on <code>MPIStateArray</code> holding the state #    of a ClimateMachine experiment.</p><p>and to</p></li><li><p>Compare against saved reference statistics from ClimateMachine <code>MPIStateArray</code> variables. This can enable simple automated regression test checks for detecting unexpected changes introduced into numerical experiments by code updates.</p></li></ol><p>These two cases are shown below:</p><h2 id=".-Generating-statistics-for-a-set-of-MPIStateArrays-1"><a class="docs-heading-anchor" href="#.-Generating-statistics-for-a-set-of-MPIStateArrays-1">1. Generating statistics for a set of MPIStateArrays</a><a class="docs-heading-anchor-permalink" href="#.-Generating-statistics-for-a-set-of-MPIStateArrays-1" title="Permalink"></a></h2><p>Here we create a callback that can generate statistics for an arbitrary set of the MPIStateArray type variables of the sort that hold persistent state for ClimateMachine models. We then invoke the call back to show the statistics.</p><p>In regular use the <code>MPIStateArray</code> variables will come from model configurations. Here we create a dummy set of <code>MPIStateArray</code> variables for use in stand alone examples.</p><h3 id="Create-a-dummy-set-of-MPIStateArrays-1"><a class="docs-heading-anchor" href="#Create-a-dummy-set-of-MPIStateArrays-1">Create a dummy set of MPIStateArrays</a><a class="docs-heading-anchor-permalink" href="#Create-a-dummy-set-of-MPIStateArrays-1" title="Permalink"></a></h3><p>First we set up two <code>MPIStateArray</code> variables. This need a few packages to be in placeT, and utilizes some utility functions to create the array and add named persistent state variables. This is usually handled automatically as part of model deefinition in regular ClimateMachine activity.</p><p>Set up a basic environment</p><pre><code class="language-">using MPI
using StaticArrays
using Random
using ClimateMachine
using ClimateMachine.VariableTemplates
using ClimateMachine.MPIStateArrays
using ClimateMachine.StateCheck
MPI.Init()
FT = Float64</code></pre><p>Define some dummy vector and tensor abstract variables with associated types and dimensions</p><pre><code class="language-">F1 = @vars begin
    ν∇u::SMatrix{3, 2, FT, 6}
    κ∇θ::SVector{3, FT}
end
F2 = @vars begin
    u::SVector{2, FT}
    θ::SVector{1, FT}
end
nothing # hide</code></pre><p>Create <code>MPIStateArray</code> variables with arrays to hold elements of the vectors and tensors</p><pre><code class="language-">Q1 = MPIStateArray{Float32, F1}(
    MPI.COMM_WORLD,
    ClimateMachine.array_type(),
    4,
    9,
    8,
)
Q2 = MPIStateArray{Float64, F2}(
    MPI.COMM_WORLD,
    ClimateMachine.array_type(),
    4,
    6,
    8,
)
nothing # hide</code></pre><h3 id="Create-a-call-back-1"><a class="docs-heading-anchor" href="#Create-a-call-back-1">Create a call-back</a><a class="docs-heading-anchor-permalink" href="#Create-a-call-back-1" title="Permalink"></a></h3><p>Now we can create a <code>StateCheck</code> call-back, <em>cb</em>, tied to the <code>MPIStateArray</code> variables <em>Q1</em> and <em>Q2</em>. Each <code>MPIStateArray</code> in the array of <code>MPIStateArray</code> variables tracked is paired with a label to identify it. The call-back is also given a frequency (in time step numbers) and precision for printing summary tables.</p><pre><code class="language-">cb = ClimateMachine.StateCheck.sccreate(
    [(Q1, &quot;My gradients&quot;), (Q2, &quot;My fields&quot;)],
    1;
    prec = 15,
)
nothing # hide</code></pre><h3 id="Invoke-the-call-back-1"><a class="docs-heading-anchor" href="#Invoke-the-call-back-1">Invoke the call-back</a><a class="docs-heading-anchor-permalink" href="#Invoke-the-call-back-1" title="Permalink"></a></h3><p>The call-back is of type <code>ClimateMachine.GenericCallbacks.EveryXSimulationSteps</code> and in regular use is designed to be passed to a ClimateMachine timestepping solver e.g.</p><pre><code class="language-">typeof(cb)</code></pre><p>Here, for demonstration purposes, we can invoke the call-back after simply initializing the <code>MPIStateArray</code> fields to a random set of values e.g.</p><pre><code class="language-">Q1.data .= rand(MersenneTwister(0), Float32, size(Q1.data))
Q2.data .= rand(MersenneTwister(0), Float64, size(Q2.data))
cb()</code></pre><h2 id=".-Comparing-to-reference-values-1"><a class="docs-heading-anchor" href="#.-Comparing-to-reference-values-1">2. Comparing to reference values</a><a class="docs-heading-anchor-permalink" href="#.-Comparing-to-reference-values-1" title="Permalink"></a></h2><h3 id="Generate-arrays-of-reference-values-1"><a class="docs-heading-anchor" href="#Generate-arrays-of-reference-values-1">Generate arrays of reference values</a><a class="docs-heading-anchor-permalink" href="#Generate-arrays-of-reference-values-1" title="Permalink"></a></h3><p>StateCheck functions can generate text that can be used to set the value of stored arrays that can be used in a reference test for subsequent regression testing. This involves 3 steps.</p><p><strong>Step 1.</strong> First a reference array setting program code is generated from the latest state of a given callback e.g.</p><pre><code class="language-">ClimateMachine.StateCheck.scprintref(cb)</code></pre><p><strong>Step 2.</strong> Next the array setting program code is executed (see below). At this stage the <em>parr[]</em> array context may be hand edited. The parr[] array sets a target number of decimal places for matching against refence values in <em>varr[]</em>. For different experiments and different fields the degree of precision that constitutes failig a regression test may vary. Choosing the <em>parr[]</em> values requires some sense as to the stability of the particular numerical and physical scenario an experiment represents. In the example below some precision settings have been hand edited from the default of 16 to illustrate the process.</p><pre><code class="language-julia">#! format: off
varr = [
 [ &quot;My gradients&quot;, &quot;ν∇u[1]&quot;,  1.34348869323730468750e-04,  9.84732866287231445313e-01,  5.23545503616333007813e-01,  3.08209930764271777814e-01 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[2]&quot;,  1.16317868232727050781e-01,  9.92088317871093750000e-01,  4.83800649642944335938e-01,  2.83350456014221541157e-01 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[3]&quot;,  1.05845928192138671875e-03,  9.51775908470153808594e-01,  4.65474426746368408203e-01,  2.73615551085745090099e-01 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[4]&quot;,  5.97668886184692382813e-02,  9.68048095703125000000e-01,  5.42618036270141601563e-01,  2.81570862027933854765e-01 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[5]&quot;,  8.31030607223510742188e-02,  9.35931921005249023438e-01,  5.05405902862548828125e-01,  2.46073509972619536290e-01 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[6]&quot;,  3.09681892395019531250e-02,  9.98341441154479980469e-01,  4.54375565052032470703e-01,  3.09461067853178561915e-01 ],
 [ &quot;My gradients&quot;, &quot;κ∇θ[1]&quot;,  8.47448110580444335938e-02,  9.94180679321289062500e-01,  5.27157366275787353516e-01,  2.92455951648181833313e-01 ],
 [ &quot;My gradients&quot;, &quot;κ∇θ[2]&quot;,  1.20514631271362304688e-02,  9.93527650833129882813e-01,  4.71063584089279174805e-01,  2.96449027197666359346e-01 ],
 [ &quot;My gradients&quot;, &quot;κ∇θ[3]&quot;,  8.14980268478393554688e-02,  9.55443382263183593750e-01,  5.05038917064666748047e-01,  2.77201022741208891187e-01 ],
 [    &quot;My fields&quot;,   &quot;u[1]&quot;,  4.31410233294131639781e-02,  9.97140933049696531754e-01,  4.62139750850942054861e-01,  3.23076684924287371725e-01 ],
 [    &quot;My fields&quot;,   &quot;u[2]&quot;,  1.01416659908237782872e-02,  9.14712023896926407218e-01,  4.76160523012988778913e-01,  2.71443440757963339038e-01 ],
 [    &quot;My fields&quot;,   &quot;θ[1]&quot;,  6.58965491052394547467e-02,  9.73216404386510802738e-01,  4.60007166313864512830e-01,  2.87310472114545079059e-01 ],
]
parr = [
 [ &quot;My gradients&quot;, &quot;ν∇u[1]&quot;,    16,     7,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[2]&quot;,    16,     7,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[3]&quot;,    16,     7,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[4]&quot;,    16,     7,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[5]&quot;,    16,     7,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;ν∇u[6]&quot;,    16,     7,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;κ∇θ[1]&quot;,    16,    16,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;κ∇θ[2]&quot;,    16,    16,    16,     0 ],
 [ &quot;My gradients&quot;, &quot;κ∇θ[3]&quot;,    16,    16,    16,     0 ],
 [    &quot;My fields&quot;,   &quot;u[1]&quot;,    16,    16,    16,     0 ],
 [    &quot;My fields&quot;,   &quot;u[2]&quot;,    16,    16,    16,     0 ],
 [    &quot;My fields&quot;,   &quot;θ[1]&quot;,    16,    16,    16,     0 ],
]
#! format: on</code></pre><p><strong>Step 3.</strong> Finally a call-back stored value can be compared for consistency to with <em>parr[]</em> decimal places</p><pre><code class="language-">ClimateMachine.StateCheck.scdocheck(cb, (varr, parr))
nothing # hide</code></pre><p>In this trivial case the match is guaranteed. The function will return <em>true</em> to the calling routine and this can be passed to an <code>@test</code> block.</p><p>However we can modify the refernce test values to see the effect of a mismatch e.g.</p><pre><code class="language-">varr[1][3] = varr[1][3] * 10.0
ClimateMachine.StateCheck.scdocheck(cb, (varr, parr))
nothing # hide</code></pre><p>Here the mis-matching field is highlighted with <em>N(0)</em> indicating that the precision was not met and actual match length was (in this case) 0. If any field fails the test returns false for use in any egression testing control logic.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../../Numerics/LinearSolvers/bgmres/">« Batched Generalized Minimal Residual</a><a class="docs-footer-nextpage" href="../../../literate_markdown/">Notes on Literate »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 19 May 2020 04:11">Tuesday 19 May 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
